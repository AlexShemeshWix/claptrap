sudo: required
language: go
go:
- 1.10.1
before_install:
- GLIDE_OS_ARCH=`go env GOHOSTOS`-`go env GOHOSTARCH`
- GLIDE_TAG=$(curl -s https://glide.sh/version)
- GLIDE_LATEST_RELEASE_URL="https://github.com/Masterminds/glide/releases/download/${GLIDE_TAG}/glide-${GLIDE_TAG}-${GLIDE_OS_ARCH}.tar.gz"
- wget ${GLIDE_LATEST_RELEASE_URL} -O /tmp/glide.tar.gz
- mkdir /tmp/glide
- tar --directory=/tmp/glide -xvf /tmp/glide.tar.gz
- export PATH=$PATH:/tmp/glide/${GLIDE_OS_ARCH}
- sudo apt-get update -q
- sudo apt-get install upx -y
install: glide install
after_success:
- |-
  echo "After Success:"
  echo $TRAVIS_TAG
  echo $TRAVIS_GO_VERSION
  if [ "$TRAVIS_TAG" != "" ] && [ "$TRAVIS_GO_VERSION" == "1.8.3" ]
  then
    mkdir build
    CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -ldflags="-s -w -X main.Version=$TRAVIS_TAG" -o build/claptrap-linux-amd64
    CGO_ENABLED=0 GOOS=darwin GOARCH=amd64 go build -ldflags="-s -w -X main.Version=$TRAVIS_TAG" -o build/claptrap-darwin-amd64
    CGO_ENABLED=0 GOOS=windows GOARCH=amd64 go build -ldflags="-s -w -X main.Version=$TRAVIS_TAG" -o build/claptrap-windows-amd64
  fi
script: go test --cover $(go list ./... | grep -v '/vendor/')
deploy:
  provider: s3
  skip_cleanup: true
  access_key_id: AKIAJ5V4JN6IDPX5TLTA
  secret_access_key:
    secure: lOHwfftwuENJijQo1XvM/O/zBmbzZJRdC2nE38eeEhm7cOMAYagMAizJ8mGxufKXPyJGIhpidiMnt6WC13Z94TaRRBYH6F9Nvuxe7j7h64fIftd3UcaxOz0W5eICT0cbXrUR0kei7yY+Cb34PCToxJ+TbisMlJvvWhvNabwCxYoAkLzECS44V40hnznsRue4ZiTOaJk6kgQvl4xLf43unv+QoufuXFkKfFKgBG5J2/1v4nL35y4sOb41RG6FKHtrmieHeca3iluS6ocFAq2gPz5i9tqo6aNhRLjGiwbockMS+6MYDDkldr5swrVOwm0L2BxE3ZivIjVVqnRE9E9HSOHbPAx2ID7GlBIurC7/P6dYuk1Z0zm36gjXV6Hhpl5FWbaEUEJyvYTdBCibDqT9p64h760dooYFiQ+OOSROiRMDq4DzNqTN/WT/jHwB2oefspD1/rsJhdtjjengiSrbxw82FgnYe7/QoLs7bpr/al2hwli6EiPaDbRsaNesTpfG6RCnfDMXdxe8pPzgy4+5mL06k8476JecAuGncGZmj4PId88gaQdkJtnIiT8Fa4iDCO8SSlmwJRz7Xn0Ph3zgk/KIXm149MYk/4cGzH9TYDE1CS5JYrpGZKwwqwmbZspbk93HmtJjwj3Zf+j0S5XeM2wTnUzHdo+IiMiZGoZAhSM=
  bucket: files.ctt-ops.com
  acl: authenticated_read
  on:
    repo: alexshemesh/claptrap
    condition: "$TRAVIS_GO_VERSION = 1.10.1"
    tags: true
  local_dir: build
